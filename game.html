<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flying Bird Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8E8 50%, #B0E0E6 100%);
        }

        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10;
            transition: opacity 0.3s;
        }

        .game-overlay.hidden {
            display: none;
        }

        .game-title {
            font-size: 48px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .game-subtitle {
            font-size: 24px;
            color: #FFF;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .start-button, .restart-button {
            padding: 15px 40px;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .start-button:hover, .restart-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .start-button:active, .restart-button:active {
            transform: translateY(-1px);
        }

        .score-display {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 36px;
            font-weight: bold;
            color: #FFF;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 5;
        }

        .high-score-display {
            position: absolute;
            top: 70px;
            right: 30px;
            font-size: 20px;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 5;
        }

        .final-score {
            font-size: 32px;
            color: #FFD700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .instructions {
            color: #FFF;
            font-size: 18px;
            text-align: center;
            margin-bottom: 20px;
            max-width: 400px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>

        <div class="score-display" id="scoreDisplay">0</div>
        <div class="high-score-display" id="highScoreDisplay">Best: 0</div>

        <div class="game-overlay" id="startOverlay">
            <div class="game-title">üê¶ Flying Bird üê¶</div>
            <div class="instructions">
                Click or press SPACE to make the bird fly!<br>
                Avoid the pipes and try to get the highest score!
            </div>
            <button class="start-button" id="startButton">Start Game</button>
        </div>

        <div class="game-overlay hidden" id="gameOverOverlay">
            <div class="game-title">Game Over!</div>
            <div class="final-score" id="finalScore">Score: 0</div>
            <div class="game-subtitle" id="newHighScore" style="display: none;">üéâ New High Score! üéâ</div>
<button class="restart-button" id="restartButton">Play Again</button>
        </div>
    </div>

    <audio id="failSound" src="audio/fail.wav" preload="auto"></audio>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const failSound = document.getElementById('failSound');

        // Logical screen size (CSS pixels)
        const screen = { w: window.innerWidth, h: window.innerHeight };
        let dpr = window.devicePixelRatio || 1;

        // Game tuning (will be recalculated on resize)
        let groundHeight = 80;
        let pipeWidth = 80;
        let pipeGap = 250;
        let pipeSpeed = 5;
        let pipeFrequency = 120;

        // State
        let gameState = 'start'; // 'start', 'playing', 'gameOver'
        let score = 0;
        let highScore = localStorage.getItem('flyingBirdHighScore') || 0;
        const pipes = [];
        const particles = [];
        let frameCount = 0;
        let audioUnlocked = false; // ensure we call play on a user gesture to unlock audio

        // Bird
        const bird = {
            x: 0,
            y: 0,
            baseWidth: 120,
            baseHeight: 120,
            scale: 1,
            velocity: 0,
            gravity: 0.55,
            jump: -10,
            color: '#FFD700',
            wingAngle: 0,
            image: null,
            imageLoaded: false,
            aspectRatio: 1
        };

        document.getElementById('highScoreDisplay').textContent = `Best: ${highScore}`;

        // Load bird image (relative path so it works when deployed)
        function loadBirdImageFromServer() {
            const img = new Image();
            img.onload = function() {
                bird.image = img;
                bird.imageLoaded = true;
                bird.aspectRatio = img.width / img.height || 1;
                recomputeSizes();
            };
            img.onerror = function() {
                console.log('No bird image found at images/bird.png, using fallback shape.');
                recomputeSizes();
            };
            img.src = 'images/bird.png';
        }
        loadBirdImageFromServer();

        // Resize and DPR handling for crisp mobile rendering
        function recomputeSizes() {
            dpr = window.devicePixelRatio || 1;
            screen.w = window.innerWidth;
            screen.h = window.innerHeight;

            // Logical ground and spacing relative to screen
            groundHeight = Math.max(56, Math.round(screen.h * 0.08));
            pipeGap = Math.max(160, Math.round(screen.h * 0.22));
            pipeWidth = Math.max(60, Math.round(screen.w * 0.09));
            pipeSpeed = Math.max(4, Math.round(screen.w * 0.006) ); // scales with width
            pipeFrequency = Math.max(70, Math.round(120 - (screen.w / 200))); // frames between pipes

            // Bird size relative to screen height
            const targetHeight = Math.round(screen.h * 0.12);
            bird.baseHeight = targetHeight;
            bird.baseWidth = Math.round(targetHeight * bird.aspectRatio);

            // Position bird relative to screen
            bird.x = Math.round(screen.w * 0.25);
            bird.y = Math.round(screen.h * 0.5);

            // Resize canvas with DPR
            canvas.style.width = screen.w + 'px';
            canvas.style.height = screen.h + 'px';
            canvas.width = Math.floor(screen.w * dpr);
            canvas.height = Math.floor(screen.h * dpr);
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        // Initial resize
        recomputeSizes();
        window.addEventListener('resize', () => {
            recomputeSizes();
            // Keep bird inside view
            bird.y = Math.min(bird.y, screen.h - groundHeight - (bird.baseHeight * bird.scale) / 2);
        });

        // Unlock audio on first user gesture (start button or first tap)
        function unlockAudio() {
            if (audioUnlocked) return;
            audioUnlocked = true;
            // Attempt to play and immediately pause to satisfy mobile/autoplay policies
            try {
                const playPromise = failSound.play();
                if (playPromise && typeof playPromise.then === 'function') {
                    playPromise.then(() => {
                        failSound.pause();
                        failSound.currentTime = 0;
                    }).catch(() => {
                        // ignore
                    });
                } else {
                    failSound.pause();
                    failSound.currentTime = 0;
                }
            } catch (err) {
                // Some browsers might still block but we tried
                console.warn('Audio unlock attempt failed or blocked:', err);
            }
        }

        // Input handling
        function handleClick() {
            if (gameState === 'start') {
                unlockAudio();
                startGame();
                return;
            }
            if (gameState === 'playing') {
                bird.velocity = bird.jump;
                createJumpParticles();
            }
            if (gameState === 'gameOver') {
                // allow quick restart by tapping
                restartGame();
            }
        }

        // Touch handling for mobile
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleClick();
        }, { passive: false });

        // Click and keyboard
        canvas.addEventListener('click', (e) => { handleClick(); });
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                handleClick();
            }
        });

        document.getElementById('startButton').addEventListener('click', (e) => { e.stopPropagation(); unlockAudio(); startGame(); });
        document.getElementById('restartButton').addEventListener('click', (e) => { e.stopPropagation(); restartGame(); });

        // Particle helpers
        function createJumpParticles() {
            for (let i = 0; i < 6; i++) {
                particles.push({
                    x: bird.x,
                    y: bird.y,
                    vx: (Math.random() * 2 - 1) * 2,
                    vy: Math.random() * 2 + 1,
                    life: 30,
                    size: Math.random() * 3 + 2,
                    color: `hsl(${Math.random() * 60 + 180}, 70%, 70%)`
                });
            }
        }
        function createScoreParticles(x, y) {
            for (let i = 0; i < 10; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: Math.random() * 4 - 2,
                    vy: Math.random() * 4 - 2,
                    life: 40,
                    size: Math.random() * 4 + 2,
                    color: `hsl(${Math.random() * 60 + 30}, 100%, 60%)`
                });
            }
        }

        function updateBird() {
            bird.velocity += bird.gravity;
            bird.y += bird.velocity;
            bird.wingAngle += 0.3;
            // Cap bird y so it doesn't go above screen
            bird.y = Math.max((bird.baseHeight * bird.scale) / 2, bird.y);
        }

        function updatePipes() {
            frameCount++;
            if (frameCount % pipeFrequency === 0) {
                const minHeight = 40;
                const maxHeight = screen.h - pipeGap - minHeight - groundHeight;
                const height = Math.max(minHeight, Math.random() * (Math.max(maxHeight, minHeight) - minHeight) + minHeight);
                pipes.push({ x: screen.w, topHeight: height, bottomY: height + pipeGap, scored: false });
            }

            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= pipeSpeed;
                // Score when pipe passes bird
                if (!pipes[i].scored && pipes[i].x + pipeWidth < bird.x) {
                    pipes[i].scored = true;
                    score++;
                    document.getElementById('scoreDisplay').textContent = score;
                    createScoreParticles(bird.x + 30, bird.y);
                }
                if (pipes[i].x + pipeWidth < 0) pipes.splice(i, 1);
            }
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                if (p.life <= 0) particles.splice(i, 1);
            }
        }

        function checkCollision() {
            const bw = bird.baseWidth * bird.scale;
            const bh = bird.baseHeight * bird.scale;
            const left = bird.x - bw / 2;
            const right = bird.x + bw / 2;
            const top = bird.y - bh / 2;
            const bottom = bird.y + bh / 2;

            // Ground collision
            if (bottom > screen.h - groundHeight) {
                triggerGameOver();
                return;
            }

            // Pipe collision
            for (const pipe of pipes) {
                const pLeft = pipe.x;
                const pRight = pipe.x + pipeWidth;
                if (right > pLeft && left < pRight) {
                    if (top < pipe.topHeight || bottom > pipe.bottomY) {
                        triggerGameOver();
                        return;
                    }
                }
            }
        }

        function triggerGameOver() {
            if (gameState !== 'playing') return;
            gameState = 'gameOver';

            // Play fail sound (should be unlocked after a user gesture)
            try {
                failSound.currentTime = 0;
                const p = failSound.play();
                if (p && typeof p.then === 'function') p.catch(() => {});
            } catch (err) {
                console.warn('Unable to play fail sound:', err);
            }

            // High score
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('flyingBirdHighScore', highScore);
                document.getElementById('highScoreDisplay').textContent = `Best: ${highScore}`;
                document.getElementById('newHighScore').style.display = 'block';
            } else {
                document.getElementById('newHighScore').style.display = 'none';
            }

            document.getElementById('finalScore').textContent = `Score: ${score}`;
            document.getElementById('gameOverOverlay').classList.remove('hidden');
        }

        function startGame() {
            if (gameState === 'playing') return;
            gameState = 'playing';
            document.getElementById('startOverlay').classList.add('hidden');
            document.getElementById('gameOverOverlay').classList.add('hidden');
            resetGame();
            requestAnimationFrame(gameLoop);
        }

        function restartGame() {
            gameState = 'playing';
            document.getElementById('gameOverOverlay').classList.add('hidden');
            resetGame();
            requestAnimationFrame(gameLoop);
        }

        function resetGame() {
            bird.y = screen.h / 2;
            bird.velocity = 0;
            pipes.length = 0;
            particles.length = 0;
            score = 0;
            frameCount = 0;
            document.getElementById('scoreDisplay').textContent = score;
        }

        // Drawing
        function drawBackground() {
            // Sky
            ctx.fillStyle = 'linear-gradient(0, #87CEEB, #B0E0E6)';
            // simpler solid sky so mobile gradient isn't expensive
            ctx.fillStyle = '#98D8E8';
            ctx.fillRect(0, 0, screen.w, screen.h);

            // Clouds (light)
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            for (let i = 0; i < 4; i++) {
                const cloudX = ((frameCount * 0.25) + i * 180) % (screen.w + 200) - 100;
                const cloudY = 40 + i * 50;
                drawCloud(cloudX, cloudY, 40 + i * 6);
            }

            // Ground
            ctx.fillStyle = '#90EE90';
            ctx.fillRect(0, screen.h - groundHeight, screen.w, groundHeight);
        }

        function drawCloud(x, y, size) {
            ctx.beginPath();
            ctx.arc(x, y, size * 0.5, 0, Math.PI * 2);
            ctx.arc(x + size * 0.4, y, size * 0.6, 0, Math.PI * 2);
            ctx.arc(x + size * 0.8, y, size * 0.5, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawBird() {
            ctx.save();
            ctx.translate(bird.x, bird.y);
            const rotation = Math.min(Math.max(bird.velocity * 0.04, -0.5), 0.7);
            ctx.rotate(rotation);
            const width = bird.baseWidth * bird.scale;
            const height = bird.baseHeight * bird.scale;
            if (bird.imageLoaded && bird.image) {
                ctx.drawImage(bird.image, -width / 2, -height / 2, width, height);
            } else {
                ctx.fillStyle = bird.color;
                ctx.beginPath();
                ctx.arc(0, 0, Math.max(12, height / 4), 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(5, -5, Math.max(3, height / 20), 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.restore();
        }

        function drawPipes() {
            for (const pipe of pipes) {
                ctx.fillStyle = '#4CAF50';
                ctx.fillRect(pipe.x, 0, pipeWidth, pipe.topHeight);
                ctx.fillStyle = '#45a049';
                ctx.fillRect(pipe.x - 5, pipe.topHeight - 20, pipeWidth + 10, 20);
                ctx.fillStyle = '#4CAF50';
                ctx.fillRect(pipe.x, pipe.bottomY, pipeWidth, screen.h - pipe.bottomY);
                ctx.fillStyle = '#45a049';
                ctx.fillRect(pipe.x - 5, pipe.bottomY, pipeWidth + 10, 20);
            }
        }

        function drawParticles() {
            for (const p of particles) {
                const alpha = Math.max(0, p.life / 40);
                ctx.globalAlpha = alpha;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.globalAlpha = 1;
        }

        function gameLoop() {
            if (gameState !== 'playing') return;
            updateBird();
            updatePipes();
            updateParticles();
            checkCollision();
            // Draw
            ctx.clearRect(0, 0, screen.w, screen.h);
            drawBackground();
            drawPipes();
            drawBird();
            drawParticles();
            requestAnimationFrame(gameLoop);
        }

        // Initial render
        drawBackground();
        drawBird();

        // Helpful note: put your custom fail sound in the existing `audio/` folder (there is already audio/fail.wav).
        // Put a replacement bird image at `images/bird.png` if you want a different bird sprite. Use an image around
        // 200x200 px for best results and the script will scale it.

    </script>
</body>
</html>
